#!/usr/bin/env bash

declare -A bkmarks=(
["WEB - YouTube"]="https://www.youtube.com/"
["WEB - WhatsApp"]="https://web.whatsapp.com/"
["WEB - ClassRoom"]="https://classroom.google.com/u/2/"
["WEB - Keep"]="https://keep.google.com/"
["WEB - ChatGPT"]="https://chat.openai.com/"
["WEB - Gemini"]="https://gemini.google.com/app"
["WEB - Grammar"]="https://quillbot.com/grammar-check"
["WEB - Translator"]="https://quillbot.com/translate"
["WEB - LMS UHN"]="https://lms.uhn.ac.id/login/index.php"
["WEB - SISFO UHN"]="https://akademik.uhn.ac.id/?mnux=login&lgn=frm&lid=120&nme=Mahasiswa"
["WEB - Nerd Fonts"]="https://www.nerdfonts.com/cheat-sheet"
["WEB - HTML Color Codes"]="https://htmlcolorcodes.com/"
["WEB - Git Repo"]="https://github.com/zvellblade26?tab=repositories"
["WEB - StirlingPDF"]="http://localhost:8080/"
["WEB - Gmail"]="https://mail.google.com/mail"
["WEB - Find My Devices"]="https://www.google.com/android/find/"
["WEB - Germany Deutsch fÃ¼r dich - Start"]="https://www.goethe.de/prj/dfd/d/dashboard"
["WEB - Ytdownloader"]="https://v2.youconvert.net/ena/"
["WEB - Tokopedia"]="https://www.tokopedia.com/"
["WEB - Shopee"]="https://shopee.co.id/"
["WEB - Calculator"]="https://www.desmos.com/scientific"
)

temp_file="/tmp/apptmp"
[ ! -f "$temp_file" ] &&
{
	ls --color=never -1 /usr/share/applications/ | sed -r 's/[@*]+$//g' | grep -vE '^(\./|\.\./)$' | sed 's/\.desktop$//'
	#ls --color=never -1 /usr/bin/ | sed -r 's/[@*]+$//g' | grep -vE '^(\./|\.\./)$'
	ls --color=never -1 "$HOME/.local/bin/" | sed -r 's/[@*]+$//g' | grep -vE '^(\./|\.\./)$'
	echo "rmtmp"
} > "$temp_file"


# Merge options: Bookmarks and commands
options=$(printf "%s\n" "${!bkmarks[@]}" && cat "$temp_file") #bash
selection=$(echo "$options" | wmenu -i) #bash

if [[ -n "$selection" ]]; then
	if [[ -v bkmarks["$selection"] ]]; then
		librewolf --new-tab "${bkmarks[$selection]}" &
		#wtype -M logo 2
	else
		code=$(echo "$selection" | cut -d' ' -f1)
		query=$(echo "$selection" | cut -d' ' -f2-)
		if [[ "$selection" =~ "rmtmp" ]]; then
			rm -rf "$temp_file"
		elif [[ "$code" =~ ^[Tt]$ ]]; then
			librewolf --new-tab "https://translate.google.com/?sl=en&tl=id&text=${query// /+}&op=translate" &
			#wtype -M logo 2
		elif [[ "$code" =~ ^[Yy]$ ]]; then
			librewolf --new-tab "https://www.youtube.com/results?search_query=${query// /+}" &
			#wtype -M logo 2
		elif [[ "$code" =~ ^[Pp]ac ]]; then
			librewolf --new-tab "https://archlinux.org/packages/?sort=&q=${query// /+}&maintainer=&flagged=" &
			#wtype -M logo 2
		elif [[ "$code" =~ ^[Yy]ay ]]; then
			librewolf --new-tab "https://aur.archlinux.org/packages?O=0&K=${query// /+}" &
			#wtype -M logo 2
		elif [[ "$code" =~ ^[DdGg]$ ]]; then
			librewolf --new-tab "https://duckduckgo.com/?q=${query// /+}" &
			#wtype -M logo 2
		elif [[ -z "$code" ]]; then
			librewolf --new-tab "https://duckduckgo.com/?q=${query// /+}" &
			#wtype -M logo 2
		else
			bash -c "$selection" & disown
		fi
	fi
else
	notify-send -t 100 "No selection made."
fi

# Cleanup temporary file
#rm -f "$temp_file"
